---
title: "hw3_nn2477"
author: "Nhu Nguyen"
date: "2023-10-11"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```



```{r}
library(tidyverse)
library(ggplot2)
library(p8105.datasets)
data("instacart")
```

## getting the number of unique aisles
```{r}
instacart %>% 
  summarise(count = n_distinct(aisle))
```

## getting the aisles with the most item ordered
```{r}
instacart %>% 
  group_by(aisle) %>% 
  summarise(total_items = n()) %>% 
  arrange(desc(total_items))
```

## making plot for aisle and number of items ordered 

```{r}
instacart %>% 
  group_by(aisle) %>% 
  summarise(total_items = n()) %>% 
  filter(total_items > 10000) %>% 
  arrange(desc(total_items)) %>% 
ggplot(aes(x = reorder(aisle, -total_items), y = total_items)) +
  geom_point() + 
  labs (
    title = "number of items ordered in each aisle", 
    x = "aisle",
    y = "total items ordered"
  ) + 
  coord_flip() + 
  theme_minimal()
```

## making a table for the three most popular items 

```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle, product_name) %>% 
  summarise(order_count = n()) %>% 
  arrange(aisle, desc(order_count)) %>% 
  group_by(aisle) %>% 
  slice_max(order_count, n = 3) %>% 
  pivot_wider(
    names_from = aisle,
    values_from = order_count)
```

## create table for pink landy apples and coffee ice cream 
```{r}
instacart %>% 
  mutate(order_dow = recode(
    order_dow,
    "0" = "sunday",
    "1" = "monday",
    "2" = "tuesday",
    "3" = "wednesday",
    "4" = "thursday",
    "5" = "friday",
    "6" = "saturday")) %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(order_dow, product_name) %>% 
  summarise(mean_hour = mean(order_hour_of_day, na.rm = TRUE)) 
```

## problem 2 
loading dataset 
```{r}
data("brfss_smart2010")
```

## cleaning dataset 

```{r}
brfss_df <- brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  rename(county = locationdesc, state = locationabbr) %>% 
  filter(topic == "Overall Health",
     response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% 
  mutate(response = factor(
    response,
    levels = c("Poor", "Fair", "Good", "Very good", "Excellent"), exclude = NULL),
    county = gsub("-", "", as.character(county)),
    county = substring(county, first = 4))

```
## 2002 data

```{r}
brfss_2002 <- brfss_df %>% 
  filter(year == 2002) %>% 
  group_by(state) %>% 
  summarise(locations = n()) %>% 
  filter(locations >= 7) 
```
In 2002,`r with(brfss_2002, paste(unique(state), collapse = ", "))` were observed to have 7 or more locations. 

## 2010 data
```{r}
brfss_2010 <- brfss_df %>% 
  filter(year == 2010) %>% 
  group_by(state) %>% 
  summarise(locations = n()) %>% 
  filter(locations >= 7) 
```
In 2010,`r with(brfss_2010, paste(unique(state), collapse = ", "))` were observed to have 7 or more locations. 


```{r}
brfss_excellent <- brfss_df %>% 
  filter(response == "Excellent") %>% 
  group_by(state) %>% 
  mutate(avg_data_value = mean(data_value)) %>%
  select(year, state, avg_data_value) 


  ggplot(brfss_excellent, aes(x = year, y = avg_data_value, group = state, color = state)) +
  geom_line() +
  labs(
    title = "average value over time by state",
    x = "year",
    y = "average value"
  ) + 
    theme_minimal()
```

